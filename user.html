<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Carpeta - Gesti√≥n de Documentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
        <div class="bg-indigo-600 p-6 text-white text-center">
            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-3">
                <i class="fas fa-cloud-upload-alt text-2xl"></i>
            </div>
            <h2 class="text-xl font-bold">Hola, <span id="uName">Empleado</span></h2>
            <p class="text-indigo-100 text-sm">Gestiona tus documentos obligatorios</p>
        </div>
        
        <div class="p-8 space-y-5">
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Tipo de Documento</label>
                <select id="tDoc" class="w-full border border-slate-200 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
                    <option value="Apta m√©dica">üìã Apta m√©dica</option>
                    <option value="Capacitaciones de PRL">üìö Capacitaciones de PRL, matrices de riesgos</option>
                    <option value="Certificado de competencia">‚ö° Certificado de competencia en riesgos el√©ctricos</option>
                    <option value="Capacitaci√≥n de trabajos en altura">üèóÔ∏è Capacitaci√≥n de trabajos en altura</option>
                    <option value="Acta de entrega de EPP">üõ°Ô∏è Acta de entrega de EPP</option>
                </select>
            </div>

            <div class="relative group">
                <label class="block text-sm font-semibold text-slate-700 mb-2">Seleccionar Archivo</label>
                <input type="file" id="fInput" class="hidden" onchange="actualizarNombreArchivo()">
                <label for="fInput" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-300 rounded-xl cursor-pointer bg-slate-50 group-hover:bg-indigo-50 group-hover:border-indigo-300 transition-all text-center px-4">
                    <i id="fileIcon" class="fas fa-file-pdf text-slate-400 group-hover:text-indigo-500 text-2xl mb-2"></i>
                    <span id="fileNameDisplay" class="text-sm text-slate-500 group-hover:text-indigo-600 font-medium break-all">Click para buscar archivo</span>
                </label>
            </div>

            <button onclick="subir()" id="btnSubir" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-indigo-200 transition-all transform active:scale-95">
                Enviar a mi Carpeta
            </button>

            <div id="status" class="text-center text-sm font-medium hidden"></div>

            <button onclick="logout()" class="w-full text-slate-400 text-sm font-medium hover:text-red-500 transition-colors pt-4 border-t border-slate-100">
                <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesi√≥n Segura
            </button>
        </div>
    </div>

    <script>
        document.getElementById('uName').innerText = localStorage.getItem('nombre');
        if (!localStorage.getItem('token')) window.location.href = 'index.html';

        function actualizarNombreArchivo() {
            const input = document.getElementById('fInput');
            const display = document.getElementById('fileNameDisplay');
            const icon = document.getElementById('fileIcon');
            
            if (input.files.length > 0) {
                display.innerText = input.files[0].name;
                display.classList.remove('text-slate-500');
                display.classList.add('text-indigo-600');
                icon.classList.replace('text-slate-400', 'text-indigo-500');
            }
        }

        async function subir() {
            const file = document.getElementById('fInput').files[0];
            const status = document.getElementById('status');
            const btn = document.getElementById('btnSubir');
            if (!file) return alert("Por favor, selecciona un archivo.");

            const formData = new FormData();
            formData.append('archivo', file);
            formData.append('tipo_documento', document.getElementById('tDoc').value);

            status.className = "text-center text-sm font-medium text-indigo-600 block";
            status.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Subiendo...';
            btn.disabled = true;

            try {
                const res = await fetch('http://localhost:3000/api/subir', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') },
                    body: formData
                });
                if (res.ok) {
                    status.className = "text-center text-sm font-medium text-emerald-600 block";
                    status.innerHTML = "‚úÖ ¬°Documento guardado con √©xito!";
                    document.getElementById('fInput').value = ""; // Reset
                    document.getElementById('fileNameDisplay').innerText = "Click para buscar archivo";
                } else {
                    status.className = "text-center text-sm font-medium text-red-600 block";
                    status.innerHTML = "‚ùå Error en el servidor";
                }
            } catch (e) {
                status.innerHTML = "‚ùå Error de conexi√≥n";
            } finally { btn.disabled = false; }
        }

        function logout() { localStorage.clear(); window.location.href='index.html'; }
    </script>
</body>
</html>